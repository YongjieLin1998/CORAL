% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/coral_base_analysis.R
\name{run_coral_ground_truth_analysis}
\alias{run_coral_ground_truth_analysis}
\title{Run the Complete (Optimized) CORAL-base Ground Truth Analysis}
\usage{
run_coral_ground_truth_analysis(
  seurat_obj,
  true_barcode_col,
  clone_size_cutoff = 2,
  num_states = 6,
  hclust_method = "ward.D",
  min_gene_mean = 0.05,
  permutation_repeats = 5,
  n_cores = NULL,
  down_sample = 1
)
}
\arguments{
\item{seurat_obj}{A Seurat object containing true clone IDs in its metadata.}

\item{true_barcode_col}{A string specifying the column name in the metadata that contains the true lineage barcode IDs.}

\item{clone_size_cutoff}{An integer. Clones smaller than this size will be excluded from the analysis. Defaults to `2`.}

\item{num_states}{An integer. The number of CORAL states (i.e., clone clusters) to create. Defaults to `6`.}

\item{hclust_method}{A string specifying the hierarchical clustering method to use. Defaults to `"ward.D"`. See `?hclust` for more options.}

\item{min_gene_mean}{A numeric value used to filter out lowly expressed genes in the heritable gene analysis. Defaults to `0.05`.}

\item{permutation_repeats}{An integer specifying the number of repeats for the permutation test to determine the Omega-squared significance threshold. Defaults to `5`.}

\item{n_cores}{An integer specifying the number of cores to use for parallel processing. Defaults to `parallel::detectCores() - 1`.}

\item{down_sample}{A numeric value between 0 and 1 for downsampling clones, primarily for quick testing. Defaults to `1` (no downsampling).}
}
\value{
An updated Seurat object with the analysis results stored in `@misc$CORAL_ground_truth_analysis`.
}
\description{
This is the main wrapper function for the `coral.base` analysis module.
  This optimized version avoids creating the N x N cell-cell distance matrix in memory,
  making it scalable to large datasets. It analyzes the structure of known lineage
  tracing clones, defines CORAL states, and identifies "heritable genes". All
  results are stored in the Seurat object's misc slot under `CORAL_ground_truth_analysis`.
}
\examples{
\dontrun{
# 1. Create a mock Seurat object for demonstration
counts <- matrix(rpois(1000 * 200, 0.5), ncol = 200, nrow = 1000)
rownames(counts) <- paste0("Gene", 1:1000)
colnames(counts) <- paste0("Cell", 1:200)
metadata <- data.frame(
  row.names = colnames(counts),
  # Create 20 clones, each with 10 cells
  true_clone_id = rep(paste0("Clone", 1:20), each = 10),
  cell_type = sample(c("A", "B"), 200, replace = TRUE)
)
seurat_obj <- CreateSeuratObject(counts, meta.data = metadata)
seurat_obj <- NormalizeData(seurat_obj)

# 2. Run the main CORAL ground truth analysis
seurat_obj <- run_coral_ground_truth_analysis(
  seurat_obj = seurat_obj,
  true_barcode_col = "true_clone_id",
  num_states = 4,
  permutation_repeats = 3, # Lower for quick example
  n_cores = 2 # Use 2 cores for the example
)

# 3. Run the advanced gene fluctuation analysis
seurat_obj <- analyze_gene_fluctuation(seurat_obj, n_cores = 2)

# 4. Visualize the results

# Clone distance heatmap
ht <- visualize_clone_distance_heatmap(seurat_obj)
ComplexHeatmap::draw(ht)

# MDS plot of clones, colored by CORAL state
mds_plot <- visualize_clone_mds(seurat_obj, color_by = "coral_state")
print(mds_plot)

# Distribution of heritable genes
dist_plot <- plot_heritable_gene_distribution(seurat_obj)
print(dist_plot)

# CORAL states on UMAP (requires running UMAP first)
# seurat_obj <- FindVariableFeatures(seurat_obj)
# seurat_obj <- ScaleData(seurat_obj)
# seurat_obj <- RunPCA(seurat_obj)
# seurat_obj <- RunUMAP(seurat_obj, dims = 1:10)
# umap_plot <- visualize_coral_states_umap(seurat_obj)
# print(umap_plot)

# Confusion matrix of states vs. cell types
confusion_heatmap <- plot_state_celltype_confusion(
  seurat_obj,
  celltype_col = "cell_type"
)
ComplexHeatmap::draw(confusion_heatmap)

# Gene fluctuation mode plot
fluctuation_plot <- plot_gene_fluctuation_mode(
  seurat_obj,
  genes_to_highlight = c("Gene1", "Gene5", "Gene10")
)
print(fluctuation_plot)
}
}
\seealso{
\code{\link{analyze_gene_fluctuation}}, \code{\link{visualize_clone_distance_heatmap}}, \code{\link{visualize_clone_mds}}
}
